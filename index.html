<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONEN STUDIO | Memo Engine</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { 
            --accent: #F59E0B; 
            --smooth: cubic-bezier(0.16, 1, 0.3, 1);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #050505; 
            color: #fff;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .glass { 
            background: rgba(255, 255, 255, 0.02); 
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.05); 
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            transition: all 0.3s var(--smooth);
        }

        .input-glass:focus {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.1);
        }

        .memo-workspace {
            min-height: 400px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .status-dot { animation: pulse-slow 2s infinite; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header -->
    <header class="max-w-[1600px] mx-auto p-6 md:p-12 flex justify-between items-end">
        <div>
            <h1 class="text-4xl font-black tracking-tighter italic text-white leading-none">ONEN <span class="text-amber-500">MEMO</span></h1>
            <p class="text-white/20 text-[10px] uppercase font-bold tracking-[0.6em] mt-3">Intelligence Core & Stock Synchronization</p>
        </div>
        <div id="connection-status" class="glass px-6 py-2.5 rounded-full text-[10px] font-black uppercase tracking-widest text-white/40 flex items-center gap-3">
            <div class="w-1.5 h-1.5 rounded-full bg-amber-500 status-dot"></div> Uplink Initializing
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-6 grid grid-cols-1 lg:grid-cols-12 gap-10 pb-24">
        
        <!-- Primary Workspace: Memo Generator -->
        <section class="lg:col-span-8 space-y-6">
            <div class="glass p-10 rounded-[3rem] relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xs font-black uppercase tracking-[0.3em] text-white/30">Active Intelligence Workspace</h2>
                    <div id="char-count" class="text-[10px] font-bold text-amber-500/50 uppercase tracking-widest">0 Characters</div>
                </div>

                <textarea id="memo-input" 
                    class="input-glass w-full p-8 memo-workspace placeholder:text-white/10" 
                    placeholder="Commence data entry... Enter shared instructions, project logs, or system status updates."></textarea>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                    <button onclick="applyTemplate('LOG')" class="glass py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all text-white/40 hover:text-white">
                        <i class="fa-solid fa-terminal mr-2"></i> System Log
                    </button>
                    <button onclick="applyTemplate('TASK')" class="glass py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all text-white/40 hover:text-white">
                        <i class="fa-solid fa-list-check mr-2"></i> Task List
                    </button>
                    <button onclick="applyTemplate('ALERT')" class="glass py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all text-white/40 hover:text-white">
                        <i class="fa-solid fa-triangle-exclamation mr-2"></i> Priority Alert
                    </button>
                </div>

                <button id="save-memo" class="mt-6 w-full bg-amber-500 text-black font-black py-6 rounded-2xl text-xs uppercase tracking-[0.4em] hover:bg-white hover:scale-[1.01] active:scale-[0.99] transition-all shadow-2xl shadow-amber-500/20">
                    Broadcast to Cloud
                </button>
            </div>

            <!-- Global Output Log -->
            <div id="memo-history" class="glass p-8 rounded-[2.5rem] min-h-[150px]">
                 <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-white/20 mb-6">Cloud Output Stream</h3>
                 <div id="memo-display-content" class="text-lg font-medium text-white/80 whitespace-pre-wrap leading-relaxed italic">
                    Waiting for data broadcast...
                 </div>
            </div>
        </section>

        <!-- Sidebar: Stock Monitor -->
        <section class="lg:col-span-4 space-y-6">
            
            <!-- Quick Add Stock -->
            <div class="glass p-8 rounded-[2.5rem]">
                <h2 class="text-[10px] font-black uppercase tracking-[0.2em] text-amber-500 mb-6">Stock Sync</h2>
                <form id="stock-form" class="space-y-3">
                    <input type="text" id="itemName" required class="input-glass w-full p-4 text-xs font-bold" placeholder="Item Identifer">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="itemQty" required class="input-glass w-full p-4 text-xs" placeholder="Qty">
                        <button type="submit" class="bg-white text-black rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-amber-500 transition-colors">Add</button>
                    </div>
                </form>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-6 rounded-[2rem]">
                    <p class="text-[8px] font-black opacity-20 uppercase tracking-widest mb-1">Items</p>
                    <p id="stat-sku" class="text-3xl font-black italic">0</p>
                </div>
                <div class="glass p-6 rounded-[2rem]">
                    <p class="text-[8px] font-black opacity-20 uppercase tracking-widest mb-1">Total Unit</p>
                    <p id="stat-items" class="text-3xl font-black italic text-amber-500">0</p>
                </div>
            </div>

            <!-- Stock List Mini -->
            <div id="stock-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                <!-- Stock Cards -->
            </div>
        </section>

    </main>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDEENrU2aGMwdeTSSHzGhovpcZlmqiTuwM", 
            authDomain: "onen-studio.firebaseapp.com",
            databaseURL: "https://onen-studio-default-rtdb.firebaseio.com",
            projectId: "onen-studio"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // TEMPLATES
        const templates = {
            LOG: `[SYSTEM LOG - ${new Date().toLocaleDateString()}]\n--------------------------\nSTATUS: Nominal\nEVENT: \nOBSERVATION: `,
            TASK: `[ACTIVE OBJECTIVES]\n- [ ] \n- [ ] \n- [ ] `,
            ALERT: `!!! PRIORITY ALERT !!!\nURGENCY: High\nMESSAGE: `
        };

        function initApp() {
            auth.signInAnonymously()
                .then(() => {
                    const statusEl = document.getElementById('connection-status');
                    statusEl.innerHTML = `<div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> System Synchronized`;
                    statusEl.classList.replace('text-white/40', 'text-green-500/80');
                    setupListeners();
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('connection-status').innerHTML = `Auth Failure`;
                });
        }

        function setupListeners() {
            const stockForm = document.getElementById('stock-form');
            const stockList = document.getElementById('stock-list');
            const memoInput = document.getElementById('memo-input');
            const saveMemoBtn = document.getElementById('save-memo');
            const memoText = document.getElementById('memo-display-content');
            const charCount = document.getElementById('char-count');

            // Character Counter
            memoInput.addEventListener('input', () => {
                charCount.innerText = `${memoInput.value.length} Characters`;
            });

            // Stock Logic
            stockForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const data = {
                    name: document.getElementById('itemName').value,
                    qty: parseInt(document.getElementById('itemQty').value),
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                };
                db.ref('inventory').push(data);
                stockForm.reset();
            });

            db.ref('inventory').on('value', (snap) => {
                const data = snap.val();
                stockList.innerHTML = '';
                let totalQty = 0;
                let skuCount = 0;

                if (data) {
                    Object.entries(data).reverse().forEach(([id, item]) => {
                        totalQty += item.qty;
                        skuCount++;
                        const card = document.createElement('div');
                        card.className = 'glass p-5 rounded-2xl flex justify-between items-center hover:bg-white/[0.04] transition-all';
                        card.innerHTML = `
                            <div>
                                <h3 class="text-[11px] font-bold text-white uppercase tracking-tight">${item.name}</h3>
                                <p class="text-[8px] text-white/20 mt-1 font-bold">L-UNIT: ${id.slice(-4)}</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="updateQty('${id}', -1)" class="w-6 h-6 rounded-md bg-white/5 flex items-center justify-center text-[10px]">-</button>
                                <span class="text-sm font-black italic w-4 text-center">${item.qty}</span>
                                <button onclick="updateQty('${id}', 1)" class="w-6 h-6 rounded-md bg-amber-500 flex items-center justify-center text-black text-[10px]">+</button>
                            </div>
                        `;
                        stockList.appendChild(card);
                    });
                }
                document.getElementById('stat-sku').innerText = skuCount;
                document.getElementById('stat-items').innerText = totalQty;
            });

            // Memo Logic
            saveMemoBtn.addEventListener('click', () => {
                const val = memoInput.value.trim();
                if(val) {
                    db.ref('sharedMemo').set({ 
                        text: val, 
                        timestamp: firebase.database.ServerValue.TIMESTAMP 
                    });
                    saveMemoBtn.innerText = "BROADCAST COMPLETE";
                    setTimeout(() => saveMemoBtn.innerText = "Broadcast to Cloud", 2000);
                }
            });

            db.ref('sharedMemo').on('value', (snap) => {
                const data = snap.val();
                if (data && data.text) {
                    memoText.innerText = data.text;
                    if (memoInput.value === "") memoInput.value = data.text;
                }
            });
        }

        window.applyTemplate = (type) => {
            document.getElementById('memo-input').value = templates[type];
            document.getElementById('char-count').innerText = `${templates[type].length} Characters`;
        };

        window.updateQty = (id, delta) => {
            db.ref(`inventory/${id}/qty`).transaction(c => (c || 0) + delta);
        };

        window.onload = initApp;
    </script>
</body>
</html>
